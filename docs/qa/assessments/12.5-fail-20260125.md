# QA Assessment: Story 12.5 - V2 Polish

## 1. Review Summary
**Date:** 2026-01-25
**Reviewer:** Quinn (Test Architect)
**Status:** **FAIL** (Regression Detected)

## 2. Code Quality Check
- [x] **Coding Standards:** Python/JS standards are generally respected.
- [x] **Project Structure:** File locations are correct.
- [x] **Documentation:** Docstrings updated correctly.

## 3. Functionality Verification
### Successes:
- **Timestamps:** Confirmed as functional by user ("l'horodatage marche").
- **UI Graphisms:** Confirmed as functional after reload.

### Failures (CRITICAL):
- **Addressing Logic:** The user reports: *"j'ai dis bonjour a lisa et tout le monde me repond"*.
    - **Analysis:** This indicates that the regex filtering `@Lisa` or `Lisa,` works technically (unit tests pass), BUT the *absence* of addressing is treating "Bonjour à Lisa" as a generic message ("Hello").
    - **Root Cause:** The `_check_addressing` logic in `BaseAgent` likely returns `None` (generic message) for "bonjour a lisa" because it doesn't match the strict `@` or `Name,` start patterns.
    - **Behavior:** AC2 states: *"If no specific address is used, standard behavior applies (all active agents may respond)"*. The implementation is *technically* compliant with the AC as written, BUT the user expectation ("parler a Lisa") is not met by the strict regex.
    - **Action:** We need to broaden the detection or clarify the user expectation. If the user says "Bonjour a Lisa", natural language understanding implies addressing, but our regex is rigid.

## 4. Recommendations
1.  **Refine Regex:** Add support for "Bonjour [AgentName]" or generic inclusion of the name in the sentence? Or strictly educate the user to use `@`?
    - *Decision:* The story AC specifies: *"If a user message starts with @AgentName or AgentName,"*.
    - *User Input:* "bonjour a lisa". This does NOT match `^@` or `^Name,`. Therefore it falls into the "Generic" bucket, so everyone responds.
    - *Correction:* The system is working *as specified*, but the specification (or the user's usage) is the mismatch.
    - *However*, there is a potential bug if the user *did* use `@Lisa` and everyone still responded. I need to verify EXACTLY what the user typed.
    - *Assumption:* User likely typed "bonjour a lisa" (no @, no comma at start).

2.  **Addressing Bug Investigation:**
    - If the user typed "Bonjour à Lisa", and `_check_addressing` returns `None` (Generic), then `BaseAgent` proceeds to `_process_narrative`.
    - Since ALL agents receive the message (Broadcast), and ALL agents see it as generic, ALL agents respond.
    - **Fix Required:** We might need a "Soft Addressing" check using the LLM itself or a more flexible regex, OR we strictly enforce the `@` syntax in the UI prompt.

## 5. Decision
**Reject**. Even if technically compliant with the strict regex AC, the user experience is broken ("Tout le monde me répond" is a cacophony).

We need to:
1.  Verify the `_check_addressing` logic again.
2.  Consider adding a "Soft Match" or instructing the User clearly.

I will request a fix to handle "Soft Addressing" or at least verify the behavior with a test case for "embedded name".