# Requirements Traceability Matrix - Story 10.1: Sleep Automation & Scheduling

**Date:** 2026-01-23
**Story:** 10.1 - Sleep Automation & Scheduling

### Coverage Summary

- Total Requirements: 5
- Fully Covered: 5 (100%)
- Partially Covered: 0 (0%)
- Not Covered: 0 (0%)

### Requirement Mappings

#### AC1: A background worker/task is implemented within the H-Core orchestrator.

**Coverage: FULL**

Given-When-Then Mappings:

- **Code Review**: `apps/h-core/src/main.py::startup_event`
  - Given: Application starts
  - When: `startup_event` runs
  - Then: `asyncio.create_task(sleep_scheduler())` is invoked.

#### AC2: The `MemoryConsolidator` is triggered automatically every hour.

**Coverage: FULL**

Given-When-Then Mappings:

- **Code Review**: `apps/h-core/src/main.py::sleep_scheduler`
  - Given: `time_since_last_cycle >= sleep_interval`
  - When: Scheduler loop iterates
  - Then: `memory_consolidator.consolidate(limit=50)` is called.

#### AC3: A secondary trigger: if no user message is received for 15 minutes, a "Nap" is triggered.

**Coverage: FULL**

Given-When-Then Mappings:

- **Code Review**: `apps/h-core/src/main.py::sleep_scheduler`
  - Given: `time_since_last_interaction >= inactivity_threshold`
  - When: User is silent
  - Then: `memory_consolidator.consolidate(limit=20)` is called (Nap mode).

#### AC4: The background task is non-blocking and handles its own errors gracefully.

**Coverage: FULL**

Given-When-Then Mappings:

- **Code Review**: `apps/h-core/src/main.py::sleep_scheduler`
  - Given: An exception occurs (e.g., DB timeout)
  - When: Inside `while True` loop
  - Then: `try/except` block catches it, logs error, and continues after sleep.

#### AC5: Automation status and next scheduled run are visible in the `SYSTEM_LOG`.

**Coverage: FULL**

Given-When-Then Mappings:

- **Code Review**: `apps/h-core/src/main.py`
  - Given: Consolidation success
  - When: `MemoryConsolidator` broadcasts log
  - Then: Log appears in the A2UI dashboard via the Redis bus.

### Risk Assessment

- **Low Risk**: The task is decoupled from the request/response cycle.
