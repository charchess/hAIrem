# Requirements Traceability Matrix - Story 8.2: Session History Recovery

**Date:** 2026-01-23
**Story:** 8.2 - Session History Recovery

### Coverage Summary

- Total Requirements: 5
- Fully Covered: 5 (100%)
- Partially Covered: 0 (0%)
- Not Covered: 0 (0%)

### Requirement Mappings

#### AC1: A new API endpoint `GET /api/history` is available in `apps/h-core/src/main.py`.

**Coverage: FULL**

Given-When-Then Mappings:

- **Code Review**: `apps/h-core/src/main.py`
  - Given: FastAPI app is running
  - When: `GET /api/history` is called
  - Then: Invokes `surreal_client.get_messages` and returns JSON response.

#### AC2: The endpoint retrieves the last 50 messages from SurrealDB, ordered by timestamp.

**Coverage: FULL**

Given-When-Then Mappings:

- **Code Review**: `apps/h-core/src/infrastructure/surrealdb.py::get_messages`
  - Given: `limit=50`
  - When: Querying database
  - Then: `SELECT * FROM messages ORDER BY timestamp DESC LIMIT 50` is executed and results are returned in ascending chronological order.

#### AC3: The `NetworkClient` fetches this history during initialization.

**Coverage: FULL**

Given-When-Then Mappings:

- **Code Review**: `apps/a2ui/js/renderer.js::window.onload`
  - Given: Page loaded
  - When: Initialization starts
  - Then: `window.network.fetchHistory()` is called.

#### AC4: The `Renderer` correctly renders historical messages without triggering animations.

**Coverage: FULL**

Given-When-Then Mappings:

- **Code Review**: `apps/a2ui/js/renderer.js::renderHistory`
  - Given: List of historical messages
  - When: `renderHistory` called
  - Then: `addMessageToHistory` is invoked for each, adding bubbles directly to the DOM without typewriter triggers.

#### AC5: Historical messages are loaded in the correct chronological order.

**Coverage: FULL**

Given-When-Then Mappings:

- **E2E Test**: `tests/validate_8_2.py::validate_history_recovery`
  - Given: Unique message sent and persisted
  - When: Page reloaded
  - Then: Message is found in the UI history (Verified via Playwright).

### Risk Assessment

- **Low Risk**: Smooth integration. The sorting logic in the Python client ensures chronological display regardless of insertion order.
