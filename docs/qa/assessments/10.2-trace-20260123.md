# Requirements Traceability Matrix - Story 10.2: The Entropy Agent (Dieu)

**Date:** 2026-01-23
**Story:** 10.2 - The Entropy Agent (Dieu/L'Ã‰tincelle)

### Coverage Summary

- Total Requirements: 6
- Fully Covered: 6 (100%)
- Partially Covered: 0 (0%)
- Not Covered: 0 (0%)

### Requirement Mappings

#### AC1: The `sleep_scheduler` publishes a `system.inactivity` message.

**Coverage: FULL**

Given-When-Then Mappings:

- **Code Review**: `apps/h-core/src/main.py::sleep_scheduler`
  - Given: Inactivity duration > `boredom_threshold`
  - When: Scheduler loop iterates
  - Then: `system.inactivity` is published to Redis `broadcast` channel.

#### AC2: The `PluginLoader` supports loading a custom `logic.py` file.

**Coverage: FULL**

Given-When-Then Mappings:

- **Code Review**: `apps/h-core/src/infrastructure/plugin_loader.py::_load_agent`
  - Given: `logic.py` exists in agent directory
  - When: Agent is loaded
  - Then: `importlib` imports the class dynamically and instantiates it.

#### AC3: A new agent plugin `agents/entropy/` is created.

**Coverage: FULL**

Given-When-Then Mappings:

- **File System Check**: 
  - Given: Directory `agents/entropy/`
  - When: Checking files
  - Then: `expert.yaml` and `logic.py` are present.

#### AC4: The "Dieu" agent listens for `system.inactivity` and sends a `system.whisper`.

**Coverage: FULL**

Given-When-Then Mappings:

- **Code Review**: `agents/entropy/logic.py::on_message`
  - Given: `system.inactivity` received
  - When: `on_message` invoked
  - Then: `_trigger_spark()` selects a target and publishes `system.whisper` to their channel.

#### AC5: The `system.whisper` contains a high-priority narrative instruction.

**Coverage: FULL**

Given-When-Then Mappings:

- **Code Review**: `agents/entropy/logic.py::_trigger_spark`
  - Given: Spark triggered
  - When: Creating whisper message
  - Then: Payload contains instruction to relance conversation.

#### AC6: `BaseAgent` is updated to process `system.whisper`.

**Coverage: FULL**

Given-When-Then Mappings:

- **Code Review**: `apps/h-core/src/domain/agent.py::on_message`
  - Given: `system.whisper` received
  - When: Processing message
  - Then: `_process_whisper` is called, which triggers `_process_narrative` with an internal instruction block.

### Risk Assessment

- **Low Risk**: The implementation perfectly follows the "Thin Orchestrator" principle. Dieu is fully isolated as a plugin.
