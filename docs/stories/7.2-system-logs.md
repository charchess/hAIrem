# Story 7.2: Real-time System Logs View

**Status:** Done
**Epic:** 7 - Agent Dashboard & UX Polishing

## Story
**As a** Developer,
**I want** to see system logs (H-Core, Redis events) directly in the UI,
**so that** I can debug agent interactions and system state without opening a terminal.

## Acceptance Criteria
1. [ ] A dedicated log viewer component is visible in the A2UI.
2. [ ] `system.log` messages from the Redis `broadcast` channel are displayed in real-time.
3. [ ] Logs are color-coded by level:
    - `INFO`: Green/White
    - `WARN`: Yellow
    - `ERROR`: Red
4. [ ] The log viewer supports auto-scroll by default, but can be paused.
5. [ ] The log viewer can be toggled (show/hide) without losing the session's logs.

## Tasks / Subtasks
- [x] Backend: Refine `RedisLogHandler` in `apps/h-core/src/main.py` (AC: #2)
    - [x] Fix potential recursion with `src.infrastructure.redis` logs.
    - [x] Ensure all system logs are properly formatted as `HLinkMessage`.
- [x] Frontend: Implement `LogViewer` component in `apps/a2ui/js/renderer.js` (AC: #1, #3)
    - [x] Create `addLog(entry)` method.
    - [x] Implement color-coding logic based on log levels.
    - [x] Ensure monospace font and dark background.
- [x] Frontend: Implement interaction logic (AC: #4, #5)
    - [x] Add "Pause" button to stop auto-scroll.
    - [x] Add "Clear" button to empty the viewer.
    - [x] Connect the "Close" button in `index.html` to toggle visibility.
- [x] Integration: End-to-End Validation (AC: #2)
    - [x] Use `/api/debug/error` endpoint to verify error log propagation.

## Dev Notes
Implementation verified with automated Playwright test `tests/validate_7_2.py`. Fixed a recursion bug where the bridge was logging its own activity to the system log handler.

## Dev Agent Record
- **Agent Model Used**: Gemini 2.0 Flash (via BMad dev agent)
- **Debug Log References**: [N/A]
- **Completion Notes List**:
    - [Initial validation complete]
    - [Backend handler refined and tested with pytest]
    - [Frontend renderer updated with all requested features]
    - [UI controls (Pause/Clear/Toggle) integrated and styled]
    - [End-to-End validation passed: real-time logs and auto-show on error confirmed]
- **File List**:
    - `apps/h-core/src/main.py`
    - `apps/h-core/tests/test_logging.py`
    - `apps/a2ui/index.html`
    - `apps/a2ui/style.css`
    - `apps/a2ui/js/renderer.js`
    - `apps/a2ui/js/network.js`
    - `tests/validate_7_2.py`


## QA Results

### Review Date: 2026-01-23

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
Implementation is excellent. The developer proactively addressed a critical recursion bug discovered during implementation. The UI is responsive and meets all requirements.

### Refactoring Performed
- **File**: `apps/h-core/src/main.py`
  - **Change**: Extraction of WebSocket bridge logging to a dedicated `bridge_logger`.
  - **Why**: Prevented an infinite loop where system logs triggered more system logs via the bridge.
  - **How**: Used `logging.getLogger("bridge")` and added it to the ignore list in the Redis log handler.

### Compliance Check
- Coding Standards: [✓]
- Project Structure: [✓]
- Testing Strategy: [✓] (Full E2E verification provided)
- All ACs Met: [✓]

### Improvements Checklist
- [x] Fixed logging recursion bug
- [x] Added automated UI validation script
- [ ] Add line limit to UI viewer to prevent memory issues in long sessions

### Gate Status
Gate: PASS → docs/qa/gates/7.2-system-logs.yml
Risk profile: docs/qa/assessments/7.2-risk-20260123.md
NFR assessment: docs/qa/assessments/7.2-nfr-20260123.md
Trace matrix: docs/qa/assessments/7.2-trace-20260123.md

### Recommended Status
[✓ Ready for Done]
