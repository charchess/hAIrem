# Story 18.1: Spatial Presence & Unity of Place

**Status:** Ready for Dev
**Epic:** 18 - Social Dynamics & Social Arbiter

## Story
**As a** User,
**I want** agents to exist in specific locations and move coherently,
**so that** I don't see the same character in two places at once (Unity of Place).

## Acceptance Criteria
1. **Agent Location State:**
    - Each agent record in SurrealDB must have a `current_location` field (e.g., `kitchen`, `garden`, `office`).
    - Default location is `home_center` (or their specific room).
2. **Unity of Place (Exclusivity):**
    - If Moka is in the `kitchen`, she MUST NOT appear visually on the `garden` tablet.
    - If the user is in the `garden` and calls Moka, she must "walk" there (change location state) before appearing.
3. **Movement Logic:**
    - Implement a `MOVE_TO(location)` action for agents.
    - When an agent moves, broadcast a `location.change` event.
    - Frontends must listen to this event:
        - **Enter:** If agent moves INTO my current view -> Fade In.
        - **Exit:** If agent moves OUT OF my current view -> Fade Out.
4. **Pocket Mode (Remote Exception):**
    - If the user is "Remote" (Pocket Mode), they are effectively in a "Virtual Lobby" (or Outside).
    - Alfred is the only permanent resident of "Outside".
    - Other agents can "project" their voice/text to Remote, but arguably should not "teleport" visually unless they move to the "Outside" location.
    - **Decision:** Remote users see Alfred. Other agents interact via Audio/Text only (Intercom style) UNLESS explicitly summoned to the "Front Door/Outside".

## Dev Notes
- **Link with Asset Manager:** The background displayed depends on the *User's* location. The agents displayed depend on the *Agents'* location matching the *User's* location.
- **Data Model:**
    - `agent`: add `location` (link to `location` table or string enum).
    - `location`: `id`, `name`, `background_prompt_template`.

## Tasks / Subtasks
- [ ] **DB Schema:** Add `location` field to `agent` table. Create `location` enum/table.
- [ ] **Backend Service:** Create `LocationService` (or add to `SocialService`).
    - `get_agents_in_location(loc_id)`
    - `move_agent(agent_id, target_loc)`
- [ ] **Frontend Update:**
    - `Stage` component must filter visible agents: `visibleAgents = allAgents.filter(a => a.location === myLocation)`.
    - Support "Ghost/Voice-Only" mode for agents speaking from another room? (Optional polish).
- [ ] **Navigation Tool:** Give agents a `move_to_room` tool so they can decide to go see Miki in the garden.

