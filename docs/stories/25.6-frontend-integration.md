# Story 25.6: IntÃ©gration Frontend & Transitions Fluides

**Status:** Ready for Review
**Epic:** 25 - Visual Imagination

## Story
**As a** User,
**I want** to see the generated images in the UI with smooth transitions,
**so that** the experience is immersive and fluid.

## Acceptance Criteria
1. **H-Link Support (UI):**
    - The A2UI must listen for and process `visual.asset` messages. [Source: architecture/13-visual-imagination.md#5]
2. **"The Stage" Rendering:**
    - Support different asset types: `background`, `overlay`.
    - `background`: Updates the main backdrop.
    - `overlay`: Shows a temporary image on top of the chat.
3. **Cross-fade Transitions:**
    - Implement CSS transitions (e.g., cross-fade) when the background changes. [Source: architecture/13-visual-imagination.md#5]
4. **Alt-text Display:**
    - Show the `alt_text` on hover or for accessibility.

## Dev Notes

### Previous Story Insights
- H-Bridge (apps/h-bridge) must be configured to serve the `/media/generated` directory as static files. [Source: architecture/13-visual-imagination.md#7]

### UI Components
- Update `Stage.tsx` or equivalent in A2UI.
- Add a listener for the `visual.asset` event in the WebSocket manager.

### Static Route (H-Bridge)
- Ensure `FastAPI` mounts the directory: `app.mount("/media", StaticFiles(directory="/media"), name="media")`.

### Testing Requirements
- Manual verification of transitions.
- Verify static file access via browser (Playwright).

## Tasks / Subtasks

- [x] **Bridge Static Route** (AC: 1)
    - [x] Update `apps/h-bridge/src/main.py` to serve `/media/generated`.
- [x] **A2UI Event Handling** (AC: 1)
    - [x] Add `VISUAL_ASSET` to the supported message types in the frontend.
    - [x] Update the state manager to store the current background URL.
- [x] **Stage Component Update** (AC: 2, 3)
    - [x] Implement the background image layer with CSS transitions.
    - [x] Implement the overlay modal for narrative assets.
- [x] **Accessibility** (AC: 4)
    - [x] Ensure `alt` tags are populated in `<img>` elements.

## Dev Agent Record

### Agent Model Used
Gemini 2.5 Flash

### Debug Log
- Updated H-Bridge to serve `/media/generated` as `/media`.
- Modified `docker-compose.yml` to share the media volume between Core and Bridge.
- Enhanced `network.js` to process `visual.asset` messages and map internal paths to web URLs.
- Refactored `renderer.js` with a second background layer for smooth cross-fade transitions.
- Implemented an overlay modal for temporary visual assets.
- Fixed indentation and syntax errors in H-Bridge.

### Completion Notes List
- Visual assets generated by agents or via `/imagine` are now displayed in real-time in the UI.
- Background changes feature a smooth 2-second cross-fade.
- Narrative assets (overlays) appear in a focused modal.

### File List
- `apps/h-bridge/src/main.py` (Modified)
- `apps/h-bridge/static/index.html` (Modified)
- `apps/h-bridge/static/js/network.js` (Modified)
- `apps/h-bridge/static/js/renderer.js` (Modified)
- `apps/h-bridge/static/style.css` (Modified)
- `docker-compose.yml` (Modified)

### Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2026-01-27 | 1.0 | Initial draft for Story 25.6 | Bob (SM) |
| 2026-01-27 | 1.1 | Completed UI integration and smooth transitions | James (Dev) |

### Status
**Status:** Ready for Review

## QA Results

### Quality Gate Decision: PASS ðŸ§ª

**Review Date:** 2026-01-28
**Reviewer:** Quinn (QA)

#### Analysis:
The UI now supports smooth cross-fade transitions and character layering. The final addition of the "Visual Novel" zoom (1.2x scale) and bottom-center anchoring has greatly improved the immersion.

#### Gate Decision File:
`docs/qa/gates/25.6-frontend-integration.yml`

#### Status
[âœ“ Done]
