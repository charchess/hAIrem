# Story 25.8: Creative Dreaming (Proactive Asset Variety)

**Status:** Draft
**Epic:** 25 - Visual Imagination

## Story
**As a** System,
**I want** the Dreamer to have "creative impulses" that go beyond simple weather/time reactivity,
**so that** agents can propose new, diverse visual styles and outfits to the user.

## Acceptance Criteria
1. **Pulsional Logic (Impulses):**
    - Enhance the `Dreamer` service to include a "Creative Impulse" generator.
    - Factors: Agent personality (from `persona.yaml`), random seeds, and recent conversation themes.
2. **Proactive Proposals:**
    - Agents should be able to "wake up" with a memory of a dream or an idea for a new look.
    - Example: Lisa starts the session by saying "I was thinking about a new style last night... want to see?".
3. **Asset Generation:**
    - Trigger `VisualImaginationService` with novel prompts generated by the LLM (acting as the Dreamer).
4. **Variety Constraint:**
    - Ensure a low similarity threshold for "Creative Dreams" to force the generation of new assets instead of reusing old ones.

## Dev Notes

### Previous Story Insights
- Story 25.3 implemented the basic `Dreamer` for weather/time backgrounds.
- Story 25.7 provided the `Vault` to store these new discoveries.

### Architecture References
- **Dreamer Flow**: [Source: architecture/13-visual-imagination.md#6]
- **Persona Context**: Descriptions in `agents/{agent_id}/persona.yaml`. [Source: architecture/13-visual-imagination.md#10]

### Implementation Strategy
1. **The Pulse**: During the sleep cycle, for each agent, ask the LLM: "Based on [Persona] and [Recent Events], what is one new visual theme or outfit this agent might dream about today?".
2. **The Generation**: Use the resulting description to trigger a proactive generation.
3. **The Hook**: Store the resulting asset ID in a "Transient Impulse" relation in the graph.
4. **The Awakening**: When the agent first speaks in the morning, inject this impulse into their context.

### File Locations
- Expansion of `apps/h-core/src/services/visual/dreamer.py`.
- New prompt template in `config/prompts.yaml` (or equivalent).

### Testing Requirements
- Verify that `Dreamer` generates a `creative_prompt` during sleep.
- Verify that the agent mentions the dream in their first morning response (mocking time).

## Tasks / Subtasks

- [ ] **Dreamer Logic Expansion** (AC: 1)
    - [ ] Update `Dreamer` to iterate over all active agents during `SLEEP_START`.
    - [ ] Implement `generate_creative_impulse(agent_id)` calling the LLM.
- [ ] **Novel Prompting** (AC: 3)
    - [ ] Create a specific prompt template for "Dreaming" that encourages variety.
- [ ] **Impulse Storage** (AC: 2)
    - [ ] Use a temporary graph edge `DREAMED_OF` or similar to link the agent to the new asset.
- [ ] **Morning Hook Integration** (AC: 2)
    - [ ] Update `BaseAgent` or `ChatService` to check for recent `DREAMED_OF` assets when the session starts.
- [ ] **Validation**
    - [ ] Run a simulated sleep cycle.
    - [ ] Check if Lisa proposes a new outfit in the "morning".
