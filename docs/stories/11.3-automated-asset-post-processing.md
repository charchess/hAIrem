# <!-- Powered by BMADâ„¢ Core -->
# Story 11.3: Automated Asset Post-Processing

## Status
- **Status:** Done

## Story
**As a** Developer,
**I want** an automated pipeline to remove backgrounds from generated agent assets,
**so that** I can integrate character illustrations seamlessly into any UI background or environment.

## Acceptance Criteria
1. Implement a Python-based utility to remove backgrounds from PNG images.
2. The utility must handle the "Solid White Background" convention established in the Style Guide.
3. The tool should preserve fine details like fur edges and glowing accents.
4. Processed images must be saved as transparent PNGs (RGBA).
5. Integration: Provide a CLI command or script that can batch-process an entire agent folder (e.g., `test_model/`).

## Tasks / Subtasks
- [x] Research and Select Library (AC: 1, 3)
    - [x] Evaluate `rembg` (U2Net) vs. OpenCV contour detection.
    - [x] Recommendation: Use `rembg` for high-quality fur/hair transparency.
- [x] Create Post-Processing Script (AC: 2, 5)
    - [x] Script should take an input directory and output to a `processed/` directory.
    - [x] Implement alpha-channel smoothing for "Cyber-Cozy" aesthetics.
- [x] Validate Output Quality (AC: 4)
    - [x] Test with the 5 test_model assets.
    - [x] Verify no "white halo" remains on the orange/violet fur.

## Dev Notes
- **Dependencies:** Requires `rembg`, `onnxruntime`, and `Pillow`.
- **Source Artifacts:**
    - `docs/visual-style-guide.md`: Updated section on "Solid Backgrounds". [Source: docs/visual-style-guide.md]
- **Previous Story Insights:**
    - Story 11.2 provides the raw assets that this story (11.3) will refine.

### Testing
- **Test file location:** `tests/validate_11_3.py`
- **Test standards:** Compare raw vs. processed files; check for the presence of an alpha channel in the output.
- **Testing frameworks:** Python standard `open` and custom PNG chunk parser.

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2026-01-23 | 1.0 | Initial Story Draft | Sally (ux) |
| 2026-01-23 | 1.1 | Implemented rembg pipeline and validated transparency | James (dev) |

## Dev Agent Record
### Agent Model Used
gemini-2.0-flash-exp

### Debug Log References
- `scripts/process_assets.py` execution logs.
- `tests/validate_11_3.py` transparency validation.

### Completion Notes List
- Created virtual environment `.venv/` to handle `rembg` dependencies.
- Implemented `scripts/process_assets.py` for batch background removal.
- Processed 5 `test_model` assets; confirmed they now have alpha channels.
- Verified transparency using a custom PNG chunk parser in `tests/validate_11_3.py`.

### File List
- `scripts/process_assets.py`
- `tests/validate_11_3.py`
- `.venv/` (Local environment)
- `apps/a2ui/public/assets/agents/test_model/*.png` (Processed)

## QA Results
*To be populated by QA Agent*