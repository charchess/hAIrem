# Story 3.2: Connecteur WebSocket Redis (The Bridge)

**Status:** Done

## Acceptance Criteria
1.  [x] Un serveur WebSocket est intégré au `h-core` (utilisant FastAPI).
2.  [x] Le serveur s'abonne au bus Redis et retransmet les messages `narrative.*` et `system.*` aux clients.
3.  [x] Le client Frontend (`a2ui`) se connecte automatiquement au démarrage.
4.  [x] Validation : Le serveur démarre, se connecte à Redis et accepte les connexions.

## Tasks / Subtasks
- [x] Task 1: FastAPI WebSocket (AC: 1)
    - [x] Créer l'endpoint `/ws` dans `apps/h-core/src/main.py`.
- [x] Task 2: Redis-to-WS Bridge (AC: 2)
    - [x] Implémenter une boucle asynchrone qui écoute Redis et envoie les JSON via WS.
- [x] Task 3: JS WebSocket Client (AC: 3)
    - [x] Créer `apps/a2ui/js/network.js` pour gérer la connexion.
    - [x] Inclure le script dans `index.html`.

## Dev Agent Record
### Agent Model Used
James (Dev) - Gemini 2.0 Flash

### Completion Notes List
- Implemented the H-Core entry point in `src/main.py`.
- Developed a WebSocket endpoint that acts as a real-time proxy for the Redis bus.
- Created `network.js` for the frontend to consume H-Link events.
- Successfully verified the backend startup sequence (Redis connect -> Plugin scan -> WS server ready).

### File List
- apps/h-core/src/main.py
- apps/a2ui/js/network.js
- apps/a2ui/index.html (updated)

## QA Results

### Review Date: 2026-01-20

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
Solid implementation of the WebSocket bridge. The frontend reconnection logic is a crucial resilience feature. The backend filtering of message types protects the frontend from unnecessary data processing.

### Refactoring Performed
None.

### Compliance Check
- Coding Standards: [x] (Async, Error handling)
- Project Structure: [x] (Frontend logic separated in network.js)
- Testing Strategy: [x] (Manual validation of server startup)
- All ACs Met: [x]

### Improvements Checklist
- [ ] For high-scale deployments, consider a Broadcast manager to share a single Redis subscription across multiple WebSocket clients. (Not needed for MVP/Home usage).

### Security Review
- WebSocket endpoint is open (no auth yet). Acceptable for local home MVP, but will need securing in a future Epic.

### Files Modified During Review
None.

### Gate Status
Gate: PASS → docs/qa/gates/3.2-websocket-bridge.yml

### Recommended Status
[x] Ready for Done
