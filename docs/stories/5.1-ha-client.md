# Story 5.1: Client WebSocket/REST Home Assistant

**Status:** Approved
**Story:**
**As a** System,
**I want** a secure connection to my Home Assistant instance,
**so that** I can read and modify the state of the home.

## Acceptance Criteria
1.  Une classe `HaClient` est implémentée dans `apps/h-core/src/infrastructure/home_assistant.py`.
2.  Authentification via `HA_TOKEN` et `HA_URL` (Variables d'environnement).
3.  Support de la lecture d'état (`get_state(entity_id)`).
4.  Support de l'appel de service (`call_service(domain, service, entity_id)`).
5.  Gestion robuste des erreurs de connexion.

## Tasks / Subtasks
- [ ] Task 1: HA Infrastructure
    - [ ] Créer `apps/h-core/src/infrastructure/home_assistant.py`.
- [ ] Task 2: State API
    - [ ] Implémenter l'appel GET `/api/states/{entity_id}`.
- [ ] Task 3: Service API
    - [ ] Implémenter l'appel POST `/api/services/{domain}/{service}`.

## Dev Notes
**Technical Context from Architecture:**
- Utiliser `httpx` (async) pour les appels REST API de HA.
- Source : [Home Assistant REST API Docs](https://developers.home-assistant.io/docs/api/rest/).

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-20 | 1.0 | Initial draft | Bob (SM) |
