# Story 1.2: Configurer le Bus Redis

**Status:** Approved
**Story:**
**As a** System,
**I want** a robust message bus based on Redis,
**so that** agents can communicate asynchronously via the H-Link protocol.

## Acceptance Criteria
1.  Le service Redis (Alpine) est accessible depuis le conteneur `h-core`.
2.  Une classe `RedisClient` asynchrone est implémentée dans `h-core`.
3.  Support du protocole **H-Link v1.0** (validation du schéma JSON de l'enveloppe).
4.  Mécanisme Pub/Sub opérationnel : capacité de s'abonner à un canal et de publier des messages.
5.  Résilience : reconnexion automatique avec Exponential Backoff.

## Tasks / Subtasks
- [ ] Task 1: Infrastructure Connection (AC: 1)
    - [ ] Configurer les variables d'env `REDIS_HOST` et `REDIS_PORT`.
    - [ ] Valider la connectivité via un ping Redis au démarrage.
- [ ] Task 2: Core Redis Client (AC: 2, 5)
    - [ ] Implémenter `apps/h-core/src/infrastructure/redis.py`.
    - [ ] Ajouter la logique de reconnexion automatique.
- [ ] Task 3: H-Link Integration (AC: 3, 4)
    - [ ] Créer les modèles Pydantic pour l'enveloppe H-Link (Source: `docs/project-documentation.md`).
    - [ ] Implémenter les méthodes `publish` et `subscribe`.
- [ ] Task 4: Integration Test (AC: 4)
    - [ ] Créer un test `pytest` vérifiant qu'un message envoyé sur un canal est reçu par un abonné.

## Dev Notes
**Technical Context from Architecture:**

*   **H-Link Protocol Spec:**
    - Source: `docs/project-documentation.md#h-link-protocol-v10-standard`
    - Envelope required fields: `id`, `timestamp`, `type`, `sender`, `recipient`, `payload`, `metadata`.

*   **Technology:**
    - Library: `redis-py` (async mode).
    - Mode: Event-Driven (Pub/Sub).

*   **Risk Mitigation:**
    - Source: `docs/qa/assessments/1.2-risk-profile-20260120.md`
    - Focus on **TECH-001 (SPOF)**: La reconnexion automatique est MANDATOIRE.

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-20 | 1.0 | Initial compliant draft | Bob (SM) |

## Dev Agent Record
### Agent Model Used
_TBD_

## QA Results
_TBD_