INFO:src.infrastructure.llm:Initializing LlmClient with URL: http://localhost:11434/v1, Model: mistral
/root/hAIrem/apps/h-core/src/main.py:82: DeprecationWarning: 
        on_event is deprecated, use lifespan event handlers instead.

        Read more about it in the
        [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
        
  @app.on_event("startup")
/root/hAIrem/apps/h-core/src/main.py:88: DeprecationWarning: 
        on_event is deprecated, use lifespan event handlers instead.

        Read more about it in the
        [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
        
  @app.on_event("shutdown")
INFO:__main__:Mounting static files from: /root/hAIrem/apps/a2ui
INFO:     Started server process [369038]
INFO:     Waiting for application startup.
INFO:__main__:H-Core is starting up (Agents: /root/hAIrem/agents)...
INFO:src.infrastructure.redis:Successfully connected to Redis at redis://localhost:6379/0
INFO:src.infrastructure.plugin_loader:Performing initial agent scan...
INFO:src.domain.agent:Agent Expert-Domotique registered command: ping
WARNING:src.infrastructure.home_assistant:HA_TOKEN is not set. Home Assistant integration will be restricted.
INFO:src.domain.agent:Registered tool: get_entity_state for agent Expert-Domotique
INFO:src.domain.agent:Registered tool: toggle_device for agent Expert-Domotique
INFO:src.domain.agent:Agent Expert-Domotique registered command: echo
INFO:src.domain.agent:Agent Expert-Domotique registered command: ping
INFO:src.domain.agent:Agent Expert-Domotique starting. Listening on agent:Expert-Domotique
INFO:src.infrastructure.plugin_loader:Agent 'Expert-Domotique' registered/updated successfully.
INFO:src.domain.agent:Agent Renarde registered command: ping
INFO:src.domain.agent:Agent Renarde starting. Listening on agent:Renarde
INFO:src.infrastructure.plugin_loader:Agent 'Renarde' registered/updated successfully.
INFO:src.infrastructure.plugin_loader:Plugin Loader started. Watching directory: /root/hAIrem/agents
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:src.infrastructure.redis:Subscribed to channel: agent:Expert-Domotique
INFO:src.infrastructure.redis:Subscribed to channel: agent:Renarde
INFO:     192.168.200.67:51558 - "WebSocket /ws" [accepted]
INFO:bridge:New A2UI client connected via WebSocket.
INFO:bridge:Subscribing to agent:user for this WebSocket session
INFO:     connection open
INFO:src.infrastructure.redis:Subscribed to channel: broadcast
INFO:src.infrastructure.redis:Subscribed to channel: agent:user
INFO:__main__:Incoming request: GET /
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"8dbb6779-188a-45d6-b8af-bc6ccc32c7e9","timestamp":"2026-01-23T01:34:53.093328","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:     127.0.0.1:57936 - "GET / HTTP/1.1" 200 OK
INFO:__main__:Incoming request: GET /style.css
INFO:__main__:Incoming request: GET /js/network.js
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"18ba6a3a-d697-40bb-8cdb-aeb9d37fecea","timestamp":"2026-01-23T01:34:53.103236","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:__main__:Incoming request: GET /js/renderer.js
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"a07f7be9-1d1f-447f-9994-9ee8f7879fe7","timestamp":"2026-01-23T01:34:53.103705","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:     127.0.0.1:57936 - "GET /style.css HTTP/1.1" 200 OK
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"66f74d46-f040-434c-b245-32171a38b739","timestamp":"2026-01-23T01:34:53.104740","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:     127.0.0.1:57940 - "GET /js/network.js?v=1.5 HTTP/1.1" 200 OK
INFO:     127.0.0.1:57956 - "GET /js/renderer.js?v=1.5 HTTP/1.1" 200 OK
INFO:__main__:Incoming request: GET /api/agents
INFO:     127.0.0.1:57966 - "WebSocket /ws" [accepted]
INFO:bridge:New A2UI client connected via WebSocket.
INFO:bridge:Subscribing to agent:user for this WebSocket session
INFO:     127.0.0.1:57956 - "GET /api/agents HTTP/1.1" 200 OK
INFO:     connection open
INFO:src.infrastructure.redis:Subscribed to channel: broadcast
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"b3fc160b-9096-4627-91b7-1977690c2fa3","timestamp":"2026-01-23T01:34:53.114785","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:src.infrastructure.redis:Subscribed to channel: agent:user
INFO:__main__:Incoming request: GET /api/debug/error
ERROR:__main__:CRITICAL_SYSTEM_FAILURE: Simulated error for UI testing.
INFO:     127.0.0.1:57970 - "GET /api/debug/error HTTP/1.1" 200 OK
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"65baecf3-ba64-4ae8-8ad8-95a2e087c0eb","timestamp":"2026-01-23T01:34:53.309171","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"65baecf3-ba64-4ae8-8ad8-95a2e087c0eb","timestamp":"2026-01-23T01:34:53.309171","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"b5edd36d-dc73-4e6d-a4c4-48f5b9bd8c29","timestamp":"2026-01-23T01:34:53.309519","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"b5edd36d-dc73-4e6d-a4c4-48f5b9bd8c29","timestamp":"2026-01-23T01:34:53.309519","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:bridge:Received from UI: {'id': '96cbaae1-66e0-4c81-b2eb-9ed45cfeb569', 'timestamp': '2026-01-23T01:34:53.483Z', 'type': 'narrative.text', 'sender': {'agent_id': 'user', 'role': 'user'}, 'recipient': {'target': 'broadcast'}, 'payload': {'content': 'Hello Renarde', 'format': 'text'}, 'metadata': {'priority': 'normal', 'ttl': 5}}
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on agent:Renarde: {"id":"96cbaae1-66e0-4c81-b2eb-9ed45cfeb569","timestamp":"2026-01-23T01:34:53.483000Z","type":"narra...
INFO:src.domain.agent:Agent Renarde received message of type narrative.text
INFO:src.domain.agent:Agent Renarde starts thinking...
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"92682d37-b822-4b35-aaf4-4fdee67abec7","timestamp":"2026-01-23T01:34:53.486167","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"92682d37-b822-4b35-aaf4-4fdee67abec7","timestamp":"2026-01-23T01:34:53.486167","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"0e0dee4e-9b01-4f4c-926b-defa005e6928","timestamp":"2026-01-23T01:34:53.485905","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"0e0dee4e-9b01-4f4c-926b-defa005e6928","timestamp":"2026-01-23T01:34:53.485905","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"dd82be5a-a7fd-409f-b8e7-1c0795eb049e","timestamp":"2026-01-23T01:34:53.486136","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"dd82be5a-a7fd-409f-b8e7-1c0795eb049e","timestamp":"2026-01-23T01:34:53.486136","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"91a3eec5-1f05-470b-a824-f4e9fa59bd84","timestamp":"2026-01-23T01:34:53.486538","type":"system...
INFO:bridge:Bridge: Received from Redis: system.status_update
INFO:bridge:Bridge: Pushing system.status_update to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"91a3eec5-1f05-470b-a824-f4e9fa59bd84","timestamp":"2026-01-23T01:34:53.486538","type":"system...
INFO:bridge:Bridge: Received from Redis: system.status_update
INFO:bridge:Bridge: Pushing system.status_update to WebSocket
INFO:openai._base_client:Retrying request to /chat/completions in 0.457757 seconds
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"61341a9d-f8a9-4aa3-9968-4b970bab74cf","timestamp":"2026-01-23T01:34:53.654048","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"61341a9d-f8a9-4aa3-9968-4b970bab74cf","timestamp":"2026-01-23T01:34:53.654048","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:openai._base_client:Retrying request to /chat/completions in 0.802405 seconds
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"e8d4554d-0434-46ba-919b-5f5c949bdaff","timestamp":"2026-01-23T01:34:54.114034","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"e8d4554d-0434-46ba-919b-5f5c949bdaff","timestamp":"2026-01-23T01:34:54.114034","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
ERROR:src.infrastructure.llm:LLM API Error: Connection error.
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"7998ddae-d6a1-4096-af31-d8ea510684ca","timestamp":"2026-01-23T01:34:54.919301","type":"narrat...
INFO:bridge:Bridge: Received from Redis: narrative.text
INFO:bridge:Bridge: Pushing narrative.text to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"7998ddae-d6a1-4096-af31-d8ea510684ca","timestamp":"2026-01-23T01:34:54.919301","type":"narrat...
INFO:bridge:Bridge: Received from Redis: narrative.text
INFO:bridge:Bridge: Pushing narrative.text to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"e68e90cd-9b89-44e8-94e3-7637e0a59a61","timestamp":"2026-01-23T01:34:54.919207","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"e68e90cd-9b89-44e8-94e3-7637e0a59a61","timestamp":"2026-01-23T01:34:54.919207","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"b57fba81-219c-45d4-957f-df90fb207602","timestamp":"2026-01-23T01:34:54.920024","type":"system...
INFO:bridge:Bridge: Received from Redis: system.status_update
INFO:bridge:Bridge: Pushing system.status_update to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"b57fba81-219c-45d4-957f-df90fb207602","timestamp":"2026-01-23T01:34:54.920024","type":"system...
INFO:bridge:Bridge: Received from Redis: system.status_update
INFO:bridge:Bridge: Pushing system.status_update to WebSocket
INFO:__main__:Incoming request: GET /
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"a8231dac-0ab8-4940-9ca5-06d0193c48c8","timestamp":"2026-01-23T01:34:55.163000","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"a8231dac-0ab8-4940-9ca5-06d0193c48c8","timestamp":"2026-01-23T01:34:55.163000","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:     127.0.0.1:57956 - "GET / HTTP/1.1" 304 Not Modified
INFO:bridge:A2UI client disconnected.
INFO:     connection closed
INFO:     127.0.0.1:57984 - "WebSocket /ws" [accepted]
INFO:bridge:New A2UI client connected via WebSocket.
INFO:bridge:Subscribing to agent:user for this WebSocket session
INFO:     connection open
INFO:src.infrastructure.redis:Subscribed to channel: broadcast
INFO:src.infrastructure.redis:Subscribed to channel: agent:user
INFO:__main__:Incoming request: GET /api/agents
INFO:     127.0.0.1:57956 - "GET /api/agents HTTP/1.1" 200 OK
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"1da3c584-48a2-492b-98cf-fc5eea914220","timestamp":"2026-01-23T01:34:55.177299","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"1da3c584-48a2-492b-98cf-fc5eea914220","timestamp":"2026-01-23T01:34:55.177299","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
ERROR:bridge:Failed to push message to WS: Unexpected ASGI message 'websocket.send', after sending 'websocket.close' or response already completed.
INFO:src.infrastructure.redis:DEBUG REDIS: Raw data on broadcast: {"id":"1da3c584-48a2-492b-98cf-fc5eea914220","timestamp":"2026-01-23T01:34:55.177299","type":"system...
INFO:bridge:Bridge: Received from Redis: system.log
INFO:bridge:Bridge: Pushing system.log to WebSocket
INFO:bridge:A2UI client disconnected.
INFO:     connection closed
